webpackJsonp([2,18],{445:function(e,t,r){(function(o){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var c,l,h,p,d=function(){function e(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,r,o){return r&&e(t.prototype,r),o&&e(t,o),t}}(),u=function e(t,r,o){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,r);if(void 0===a){var n=Object.getPrototypeOf(t);return null===n?void 0:e(n,r,o)}if("value"in a)return a.value;var i=a.get;if(void 0!==i)return i.call(o)};r(446);var f=r(314),m=r(448),_=a(m),b=r(449),g=a(b),x=r(443),S=a(x),y=r(309),v=a(y),w=r(450),k=a(w),E=r(277),C=r(335),T=100,H=(c=(0,v.default)(k.default),c((p=h=function(e){function t(){var e;n(this,t);for(var r=arguments.length,o=Array(r),a=0;a<r;a++)o[a]=arguments[a];var s=i(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o)));return s.state={page:1,loadStatus:0},s.setTitle("搜索演出"),s}return s(t,e),d(t,[{key:"componentWillMount",value:function(){u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"componentWillMount",this).call(this),this.props.actions.fetchConcerts({city_name:this.props.city}),this.props.actions.fetchHotWords(),this.props.actions.fetchSearchHistory()}},{key:"pageNation",value:function(e,t,r,o,a){var n=this,i=r?this.props.searchResult:[],s={city_name:t?t:this.props.city,per_page:E.PAGE_SIZE,page:r?r:1,keyword:e};this.props.actions.fetchSearch(s,i).then(function(){n.state.page>=n.props.totalCount/E.PAGE_SIZE&&(a||n.setState({loadStatus:1})),o&&(n.props.actions.saveSearchHistory(e),n.setState({keyword:e}))})}},{key:"componentWillUnmount",value:function(){this.pageNation("",this.props.searchCity,"","",!0)}},{key:"componentDidMount",value:function(){if("POP"===this.props.location.action){var e=cache.store.get("__SEARCH_HISTORY__")[0];this.setState({keyword:e}),this.pageNation(e,this.props.searchCity),this.refs.searchInput.value=e}}},{key:"debounce",value:function(e,t){var r=void 0,o=void 0,a=null,n=function(){e.apply(r,o),a=null};return function(){r=this,o=arguments,a&&(clearTimeout(a),a=null),a=setTimeout(n,t)}}},{key:"onSearchChange",value:function(e){var t=this;e=e.trim(),""!==e&&(this.setState({keyword:e}),window.requestAnimationFrame(function(){return t.pageNation(e,t.props.searchCity)}))}},{key:"onSearchEnd",value:function(e){var t=e.target.value.trim();""!==t&&(this.he("send","event","top_search","click","search_confirm",t),t.length&&this.props.actions.saveSearchHistory(t))}},{key:"onClearSearchHistory",value:function(){this.props.actions.clearSearchHistory()}},{key:"onToggleCity",value:function(){var e=this.props.current?"全国":this.props.city;he("send","event","search_result","click","search_result_onecity",this.props.current?"false":"true"),this.pageNation(this.props.keyword,e)}},{key:"onHotWordClick",value:function(e,t){"button"===t?he("send","event","hot_words","click","hot_words",e.words):he("send","event","history_words","click","history_words",e.words),this.refs.searchInput.refs.input.value=e.words,this.pageNation(e.words,this.props.searchCity,"",!0)}},{key:"onScroll",value:function(e){var t=e.target,r=(this.props.searchResult,this.props.totalCount),o=this;if(this.props.searchMode&&r){var a=r/E.PAGE_SIZE;if(t.scrollTop+t.clientHeight>t.scrollHeight-T&&this.state.page<=a){if(o.isToLoad)return;var n=this.state.page+1;this.setState({page:n}),this.pageNation(this.state.keyword,this.props.searchCity,n),o.isToLoad=1,setTimeout(function(){o.isToLoad=0},1e3)}}}},{key:"onCloseSearch",value:function(){this.context.router.goBack()}},{key:"render",value:function(){var e=this,t=this.props,r=t.searchResult,a=t.searchMode,n=t.hotwords,i=(t.keyword,t.searchHistory),s=t.recommend,c=t.totalCount,l=this.state.page;return o.createElement("div",{className:"Search",id:"Search"},o.createElement("div",{className:"Search__Container flex flex-columns",ref:"search"},o.createElement("div",{className:"Search__Header"},o.createElement("div",{className:"Search__Box flex flex-center"},o.createElement(f.Text,{className:"flex-auto",prefix:o.createElement(f.Icon,{type:"search"}),onChange:this.debounce(function(t){e.onSearchChange(t)},200),onBlur:this.onSearchEnd.bind(this),autoFocus:!0,clearable:!0,ref:"searchInput"}),o.createElement("div",{className:"cancel",onClick:this.onCloseSearch.bind(this),"data-he":"search_cancel"},"取消")),!!a&&o.createElement("div",{className:"Search__Filter flex"},o.createElement("div",{className:"flex-auto"},"找到",o.createElement("i",null," ",c||0," "),"条相关内容"),o.createElement(f.Checkbox,{onChange:this.onToggleCity.bind(this),checked:this.props.current},"只看当前城市"))),o.createElement("div",{className:"Search__Content flex-auto",onScroll:this.onScroll.bind(this)},a?o.createElement(g.default,{result:r.slice(0,l*E.PAGE_SIZE),recommend:s,router:this.context.router}):o.createElement(_.default,{hotwords:n,onClick:this.onHotWordClick.bind(this),searchHistory:i,onClearHistory:this.onClearSearchHistory.bind(this)}),a&&r.length>5&&o.createElement(C.LoadMore,{status:this.state.loadStatus}))))}}]),t}(S.default),h.contextTypes={router:o.PropTypes.object},l=p))||l);t.default=H,e.exports=t.default}).call(t,r(1))},446:function(e,t,r){var o=r(447);"string"==typeof o&&(o=[[e.id,o,""]]);r(46)(o,{});o.locals&&(e.exports=o.locals)},447:function(e,t,r){t=e.exports=r(42)(),t.push([e.id,"@font-face{font-family:digital;src:url("+r(43)+") format(\"truetype\");font-weight:400;font-style:normal}#Search .Text{position:relative;height:28px;border-radius:14px;padding:2px;color:#333}#Search .Text:after{content:'';position:absolute;width:200%;height:200%;top:0;left:0;-webkit-transform:scale(.5);-ms-transform:scale(.5);transform:scale(.5);-webkit-transform-origin:0 0;-ms-transform-origin:0 0;transform-origin:0 0;-webkit-box-sizing:border-box;box-sizing:border-box;pointer-events:none;border:1px solid #d1d6e7;border-radius:28px}#Search .Text__input{padding:0}#Search .Text .Ico--search:after{color:#a4aecf}#Search .Text__clearable{background-color:#a4aecf}#Search .Text__input input{margin-right:5px;-webkit-appearance:none;font-size:12px;border:none;border-radius:0;-webkit-box-shadow:none;box-shadow:none}#Search .Search__Container{height:100vh;background:#fbfbfb;-webkit-tap-highlight-color:transparent}#Search .Search__Box{padding:8px 10px;position:relative;min-height:30px}#Search .Search__Box:after{content:'';position:absolute;width:200%;height:1px;bottom:0;left:0;-webkit-transform:scale(.5);-ms-transform:scale(.5);transform:scale(.5);-webkit-transform-origin:0 0;-ms-transform-origin:0 0;transform-origin:0 0;-webkit-box-sizing:border-box;box-sizing:border-box;border-bottom:1px solid #e5e5e5}#Search .Search__Filter{line-height:29px;padding:0 10px;font-size:12px;position:relative}#Search .Search__Filter label:after{content:'';position:absolute;width:200%;height:200%;top:0;left:0;-webkit-transform:scale(.5);-ms-transform:scale(.5);transform:scale(.5);-webkit-transform-origin:0 0;-ms-transform-origin:0 0;transform-origin:0 0;-webkit-box-sizing:border-box;box-sizing:border-box;border-bottom:1px solid #e5e5e5}#Search .Search__Filter i{color:#29cc6d}#Search .Search__Header{background:#fff}#Search .Search__Header .cancel{padding-left:10px;font-size:12px;color:#29cc6d}#Search .Search__Header .Text__prefix{padding:.2rem}#Search .Search__Header .Checkbox--faux{width:12px;height:12px}#Search .Search__Header .Checkbox--faux:after{height:4px!important;width:10px!important;top:50%;left:50%;-webkit-transform:translate3d(-43%,-75%,0) rotate(-52deg);transform:translate3d(-43%,-75%,0) rotate(-52deg)}#Search .Search__Content{overflow:hidden;overflow-y:auto;background:#fff}#Search .Search__Content .Loading{margin-top:35vh}#Search .Search__Recommends{max-height:123px;overflow:hidden;padding-left:10px;margin-bottom:10px;margin-top:5px}#Search .Search__Recommends .Button{margin:5px 10px 10px 0;color:#333;background:#f5f5fb;border:1px solid #f5f5fb;border-radius:4px;font-family:PingFangSC-Regular}#Search .Search__Tittle{position:relative;padding-left:10px;font-size:14px;color:#333;line-height:30px;margin-top:5px;font-family:PingFangSC-Regular}#Search .Search__Tittle:after{content:'';position:absolute;width:200%;height:200%;top:0;left:0;-webkit-transform:scale(.5);-ms-transform:scale(.5);transform:scale(.5);-webkit-transform-origin:0 0;-ms-transform-origin:0 0;transform-origin:0 0;-webkit-box-sizing:border-box;box-sizing:border-box;border-bottom:1px solid #e5e5e5}#Search .Search__History{padding-left:10px}#Search .Search__History__Item{position:relative;line-height:38px;color:#666;font-family:PingFangSC-Regular}#Search .Search__History__Item:after{content:'';position:absolute;width:200%;height:200%;top:0;left:0;-webkit-transform:scale(.5);-ms-transform:scale(.5);transform:scale(.5);-webkit-transform-origin:0 0;-ms-transform-origin:0 0;transform-origin:0 0;-webkit-box-sizing:border-box;box-sizing:border-box;border-bottom:1px solid #e5e5e5}#Search .Search__Clear .Button{margin-top:18px;color:#666;font-size:12px;padding:.8em 3em;border:1px solid #efefef;border-radius:4px;background:#f5f5f5;font-family:PingFangSC-Regular}#Search .Search__List{overflow:hidden;overflow-y:auto;min-height:80vh;padding-left:10px;-webkit-transform:translateZ(0);transform:translateZ(0)}#Search .Search__List__Div{width:80%;padding:5px 15px 0 5px}#Search .Search__List__Div:after{content:'';position:absolute;width:200%;height:200%;top:0;left:0;-webkit-transform:scale(.5);-ms-transform:scale(.5);transform:scale(.5);-webkit-transform-origin:0 0;-ms-transform-origin:0 0;transform-origin:0 0;-webkit-box-sizing:border-box;box-sizing:border-box;border-bottom:1px solid #e5e5e5}#Search .Search__List a{display:block}#Search .Search__List h3{line-height:2;color:#666;margin-bottom:0;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;padding-right:20px;font-weight:400}#Search .Search__Timeout__Icon{margin-top:18px}#Search .Search__Timeout__Icon .Label{padding:2px 3px;-webkit-box-shadow:none;box-shadow:none;position:relative;color:#999}#Search .Search__Timeout__Icon .Label:after{content:'';position:absolute;width:200%;height:200%;top:0;left:0;-webkit-transform:scale(.5);-ms-transform:scale(.5);transform:scale(.5);-webkit-transform-origin:0 0;-ms-transform-origin:0 0;transform-origin:0 0;-webkit-box-sizing:border-box;box-sizing:border-box;pointer-events:none;border:1px solid #999;border-radius:3px}#Search .Search__Item:after{border-right:1px solid #ddd;border-bottom:1px solid #ddd;width:8px;height:8px}#Search .Search__Item__Title{color:#333;font-size:14px;margin-top:3px;font-family:PingFangSC-Regular}#Search .Search__Item__Title__Timeout{color:#999}#Search .Search__Item__Time{font-size:12px;color:#999;margin-top:-5px;line-height:30px}#Search .Search__Item__Time span{font-size:14px;vertical-align:top}#Search .Search__Empty{text-align:center;background:#f5f5fb;padding-top:10px;padding-bottom:10px}#Search .Search__Empty p{margin:auto;color:#666;height:10vh;line-height:10vh}#Search .Search__Empty p,#Search .Search__Like{position:relative;font-size:14px;background-color:#fff}#Search .Search__Like{color:#333;line-height:40px;padding-left:10px}#Search .Search__Like:after{content:'';position:absolute;width:200%;height:200%;top:0;left:0;-webkit-transform:scale(.5);-ms-transform:scale(.5);transform:scale(.5);-webkit-transform-origin:0 0;-ms-transform-origin:0 0;transform-origin:0 0;-webkit-box-sizing:border-box;box-sizing:border-box;border-bottom:1px solid #e5e5e5}#Search .Search .Button--secondary-inverse{color:#29cc6d;border:1px solid #29cc6d;border-radius:5px}#Search .Search .HotWords p{margin-top:10px;line-height:25px}#Search .Search .HotWords .recommends{padding-top:5px}",""])},448:function(e,t,r){(function(o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(314);t.default=function(e){return o.createElement("div",{className:"HotWords"},o.createElement("p",{className:"Search__Tittle"},"热搜"),o.createElement("div",{className:"Search__Recommends"},e.hotwords.map(function(t,r){return o.createElement(a.Button,{type:"inverse",key:t.id,onClick:e.onClick.bind(null,t,"button")},t.words)})),!!e.searchHistory.length&&o.createElement("div",null,o.createElement("p",{className:"Search__Tittle"},"历史记录"),o.createElement("ul",{className:"Search__History"},e.searchHistory.map(function(t,r){return o.createElement("li",{key:r,onClick:e.onClick.bind(null,{words:t}),className:"Search__History__Item"},o.createElement("div",{className:"arr-r-self"},t))})),o.createElement("div",{className:"Search__Clear"},o.createElement(a.Button,{type:"inverse",className:"auto-center",onClick:e.onClearHistory,disabled:!e.searchHistory.length,"data-he":"history_words_delete"},"清空历史记录"))))},e.exports=t.default}).call(t,r(1))},449:function(e,t,r){(function(o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(184),n=r(335),i=r(314);t.default=function(e){var t=e.result;return t?t.length?o.createElement("ul",{className:"Search__List"},t.map(function(e,t){return o.createElement("li",{className:"Search__Item arr-r-self",key:t},o.createElement(a.Link,{className:"flex",to:{pathname:"/detail/"+e.id,query:{static_api:e.static_api}},"data-he":"search_result_item"},o.createElement("div",{className:"Search__List__Div flex-columns"},o.createElement("div",{className:e.status===-1?"Search__Item__Title Search__Item__Title__Timeout ell":"Search__Item__Title ell"},e.item_title_cn),o.createElement("p",{className:"Search__Item__Time ell"},e.time_layout,o.createElement("span",null," | "),e.venue.name)),o.createElement("div",{className:"Search__Timeout__Icon flex-columns"},e.status===-1&&o.createElement(i.Label,null,"已结束"))))})):o.createElement("div",null,o.createElement("div",{className:"Search__Empty"},o.createElement("p",null,"暂无符合条件的项目")),e.recommend.length>0&&o.createElement("div",null,o.createElement("p",{className:"Search__Like"},"搜索此关键字的人还喜欢"),o.createElement(n.ConcertList,{concerts:e.recommend,router:e.router}))):o.createElement(Loading,{type:"circle"})},e.exports=t.default}).call(t,r(1))},450:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r(374),a=function(e){return e.home.city},n=function(e){return e.search.searchResult},i=function(e){return e.search.prevSearchResult},s=function(e){return e.search.totalCount},c=function(e){return e.search.keyword},l=function(e){return e.search.cityName},h=function(e){return e.search.hotwords},p=function(e){return e.search.searchHistory},d=function(e){return e.home.concerts};t.default=(0,o.createSelector)(a,n,i,s,h,c,l,p,d,function(e,t,r,o,a,n,i,s,c){var l=e.name===i;l||"全国"===i||(i="全国"),c=c.list.slice(0,5);var h=r?r.concat(t):t;return{city:e.name,searchCity:i,searchResult:h,totalCount:o,hotwords:a,keyword:n,searchMode:!!n.length,current:l,searchHistory:s,recommend:c}}),e.exports=t.default}});