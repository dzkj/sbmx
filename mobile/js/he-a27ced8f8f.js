!function(){function t(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function e(){return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}function i(){return localStorage.getItem("__he_q__")||""}function o(t){var e=i();e=e&&e.length>1?e.split("|"):[],e.push(t),e.length>12&&e.shift(),localStorage.setItem("__he_q__",e.join("|"))}function n(){this.init()}var r=!!window.performance&&!!window.performance.getEntries,a="//hawkeye-server.wepiao.com/",p=a+"c.gif",s=1;n.prototype.init=function(){this.pvid=e(),this.initEvent(),this.initReferrer(),this.initSpm(),r&&this.initTiming()},n.prototype.initSpm=function(){for(var t,e={},i=location.search.replace(/^\?/,"").split("&"),o=i.length,n=0;o>n;n++)i[n]&&(t=i[n].split("="),e[t.splice(0,1)]=t.join("="));var r=e._wepiao_spm,a=e._wepiao_from||e.from;if(r&&/^(\S{1,4}\.){3}\S{1,4}$/.test(r)){var p=this.getCookie("_wepiao_spm");p&&/^(\S{1,4}\.){3}\S{1,4}$/.test(p)&&(r=p.split(".").slice(0,2).concat(r.split(".").slice(2,4)).join(".")),this.setCookie("_wepiao_spm",r,".wepiao.com")}a&&/^\d{1,16}$/.test(a)&&this.setCookie("_wepiao_from",a,".wepiao.com")},n.prototype.getCookie=function(t){var e=document.cookie.match(new RegExp("(^| )"+t+"=([^;]*)(;|$)"));return null!==e?decodeURIComponent(e[2]):""},n.prototype.setCookie=function(t,e,i){document.cookie=t+"="+encodeURI(e)+";path=/; domain="+i},n.prototype.addEventListener=function(t,e,i){t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent("on"+e,i)},n.prototype.setOpt=function(){},n.prototype.initEvent=function(){this.addEventListener(document,"click",this.onClick.bind(this)),this.addEventListener(window,"beforeunload",this.close.bind(this))},n.prototype.initReferrer=function(){this.referrer=document.referrer,window.__ISWEMOVIESPA__&&window.addEventListener("hashchange",function(t){var e=t.oldURL;this.referrer!==e&&(this.referrer=e)}.bind(this),!1)},n.prototype.onClick=function(t){var e=(t.target,this.parseDOMPath(t)),i=e.heID;if(i){var o=t.pageX+"_"+t.pageY,n={url:p,id:i,tu:e.parentHref,tp:o};this.trackClick(n)}},n.prototype.trackClick=function(t){var e=[p,"?type=c","&pvid="+this.pvid,"&tp="+t.tp];t.id&&e.push("&id="+t.id),t.tu&&e.push("&tu="+encodeURIComponent(t.tu)),this.log(e.join(""))},n.prototype.parseDOMPath=function(t){var e=t.path;if(!e||"object"!=typeof e){e=[];var i=t.target;do e.push(i),i=i.parentNode;while(i);e.push("window")}var o,n,r=t.target,a=e.length;if(a>2){for(var p="",s=0,a=e.length-4;a>s;s++){var c=e[s];if(n||(n=c.getAttribute("data-he")),!o){var d=c.tagName.toLowerCase();"a"===d?o=c.href:"submit"===r.type&&"form"===d&&c.action&&(o=c.action)}}p="body"+p,p=p.toLowerCase()}else p="body";return{selector:p,heID:n,parentHref:o}},n.prototype.trackPageView=function(t){o(this.page);var n=this.page,r=this.app;setTimeout(function(){i();this.pvid=e();var o=this.getReferrer(),a=p+"?type=p&pvid="+this.pvid;a+="&ru="+encodeURIComponent(o),t&&(a+="&item="+t),n&&(a+="&page="+n),r&&(a+="&app="+r),this.log(a)}.bind(this),1)},n.prototype.log=function(t){var e=new Image(1,1);e.onload=null,e.onerror=null,window.__VERSION_FOR_HE__&&(t+="&v="+window.__VERSION_FOR_HE__),t+="&u="+encodeURIComponent(location.href),e.src=t+"&r="+(new Date).getTime()},n.prototype.getReferrer=function(){var t=this.referrer;return t&&""!==t||(t=document.referrer),t},n.prototype.close=function(){this.destoryEvent()},n.prototype.destoryEvent=function(){document.removeEventListener("click",this.onClick)},n.prototype.initTiming=function(){var t=this;this.timingCurrent=0;var e=Math.random();s>e&&("complete"===document.readyState?setTimeout(function(){t.trackTiming2()},1e3):document.onreadystatechange=function(){"complete"==document.readyState&&setTimeout(function(){t.trackTiming2()},1e3)})},n.prototype.trackTiming2=function(){var t=performance.timing,e={type:"html",start:t.redirectStart||t.fetchStart||t.domainLookupStart||t.connectStart,redirect:t.redirectEnd-t.redirectStart,dns:t.domainLookupEnd-t.domainLookupStart,tcp:t.connectEnd-t.connectStart,request:t.responseStart-t.requestStart,reponse:t.domLoading-t.responseStart,initDomTreeTime:t.domInteractive-t.domLoading,domReadyTime:t.domComplete-t.domInteractive,processing:t.domComplete-t.domLoading,load:t.loadEventEnd-t.loadEventStart};this.timing(e)},n.prototype.timing=function(t){var e=[p,"?type=t","&pvid="+this.pvid,"&pt="+encodeURIComponent(JSON.stringify(t))].join("");this.page&&(e+="&page="+this.page),this.app&&(e+="&app="+this.app),this.log(e)},n.prototype.event=function(t){var e=this.pvid,i=this.page,o=this.app;setTimeout(function(){var n=[p,"?type=e","&pvid="+e,"&c="+t.category,"&a="+t.action].join("");t.label&&(n+="&l="+t.label),t.value&&(n+="&val="+t.value),i&&(n+="&page="+i),o&&(n+="&app="+o),this.log(n)}.bind(this),1)},n.prototype.error=function(t){var e=[p,"?type=err","&pvid="+this.pvid,"&error="+encodeURIComponent(t.err)].join("");t.id&&(e+="&id="+t.id),this.app&&(e+="&app="+this.app),this.page&&(e+="&page="+this.page),this.log(e)},n.prototype.send=function(t,e,i,o,n){if("pageview"===t){if(!e)throw Error("No PageID");this.page=e,this.trackPageView(i)}else"event"===t?this.event({category:e,action:i,label:o,value:n}):"timing"===t?this.timing({type:e,name:i,time:o,start:n}):"error"===t&&this.error(e,i)},n.prototype.create=function(t){this.app=t};var c=new n,d=(window.he||[]).q;return window.he=function(t,e,i,o,n,r){try{c[t](e,i,o,n,r)}catch(a){console.log(a)}},d&&d.map(function(t){window.he.apply(this,t)}),window.he}();