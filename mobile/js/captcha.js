!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.Captcha=t()}(this,function(){function e(t){var n=[].slice.call(arguments,1);if(n&&t&&"object"==typeof t){for(var o=0,r=n.length;o<=r;o++)!function(n){for(var o in n)n.hasOwnProperty(o)&&("[object Object]"===Object.prototype.toString.call(n[o])?t[o]=e({},t[o],n[o]):t[o]=n[o])}(n[o]);return t}}function t(e,t,n){e.addEventListener?e.addEventListener(t,n):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n}function n(e,t,n){e.removeEventListener?e.removeEventListener(t,n):e.detachEvent?e.detachEvent("on"+t,n):e["on"+t]=function(){}}function o(e){return document.createElement(e)}function r(){var e={imgWrapper:{"default":{width:"100%",height:"32px","border-radius":"50px",overflow:"hidden",border:"1px solid #9a9a9a","box-sizing":"border-box",background:"none"},success:{},error:{}},slider:{"default":{display:"inline-block",position:"absolute",top:"-3px",left:0,background:"white",border:"1px solid #9a9a9a","border-radius":"5px",color:"#ccc",width:"25px","text-align":"center",transform:"translateX(-50%)","-webkit-transform":"translateX(-50%)","-ms-transform":"translateX(-50%)","-moz-transform":"translateX(-50%)","box-sizing":"border-box","line-height":"35px",cursor:"pointer"},success:{},error:{}},sliderWrapper:{"default":{},success:{},error:{}},text:{"default":{width:"100%",height:"auto"},success:{},error:{}},body:{"default":{padding:"15px",margin:0,height:"100%"},success:{},error:{}},html:{"default":{padding:0,margin:0,height:"100%"},success:{},error:{}},wrapper:{"default":{position:"relative"},success:{},error:{}},textWrapper:{"default":{"margin-top":"20px",background:"none",padding:"20px",height:"40px",display:"-webkit-box",$display:"-ms-flexbox",$$display:"-webkit-flex",$$$display:"flex","-webkit-box-align":"center","-ms-flex-align":"center","-webkit-align-items":"center","align-items":"center","-webkit-box-pack":"center","-ms-flex-pack":"center","-webkit-justify-content":"center","justify-content":"center"},success:{},error:{}},resultMessage:{"default":{display:"none","text-align":"center",margin:0,padding:0},success:{},error:{}},sliderBlock:{"default":{display:"inline-block",height:"100%",margin:0,padding:0}}};return e}function i(){var e={imgWrapper:".captcha-image-wrapper",slider:".captcha-slider",text:".captcha-text",body:"body",html:"html",wrapper:".captcha-wrapper",textWrapper:".captcha-text-wrapper",resultMessage:".captcha-message",sliderWrapper:".captcha-slider-wrapper",sliderContainer:".captcha-slider-container",sliderBlock:".captcha-slider-block",sliderColorPane:".captcha-slider-color-pane",sliderColorCircle:".captcha-slider-color-circle"};return e}function a(t){var n,a,s,c,l=e({},r(),t),d="";for(var u in l)if(l.hasOwnProperty(u)){n=l[u]["default"],a=l[u].success,s=l[u].error,c=i()[u],d=d+"\n"+c+"{\n    ";for(var p in n)d=d+p.replace(/\$/g,"")+": "+n[p]+";\n    ";"body"===c?d+="}\nbody.success {\n   ":d=d+"}\n.success "+c+"{\n    ";for(var f in a)d=d+f.replace(/\$/g,"")+": "+a[f]+";\n    ";"body"===c?d+="}\nbody.error {\n    ":d=d+"}\n.error "+c+"{\n    ";for(var h in s)d=d+h.replace(/\$/g,"")+": "+s[h]+";\n    ";d+="}"}var w,m=document.querySelectorAll(".custom-style"),u=0,g=m.length;if(g)for(;u<g;u++)w=m[u],w.parentNode.removeChild(w);var b=o("style");b.innerHTML=d,b.className="custom-style",document.body.appendChild(b)}function s(o,r){function s(e){return M?e.changedTouches[0].clientX:e.clientX}function c(e){if("object"==typeof e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n+"="+e[n]);return t.join("&")}}function l(n,o){var r="jsonp"+ +new Date+Math.floor(100*Math.random()),i=e({},N,n);i.params.jsonp=r;var a=c(i.params),s=i.url;a&&(s=i.url+"?"+a);var l;window[r]=function(e){l=e};var d=document.createElement("script");t(d,"load",function(){"undefined"==typeof l?o({ret:"CAN_NOT_GET_DATA",msg:"无法正确获取数据",data:s}):o(void 0,l),delete window[r],d.parentNode.removeChild(d)}),t(d,"error",function(e){delete window[r],d.parentNode.removeChild(d),o({ret:"CAN_NOT_LOAD_SCRIPT",msg:"请求数据失败",data:s})}),d.src=s,(document.head||document.body).appendChild(d)}function d(e){var t=i();for(var n in t)if(t.hasOwnProperty(n)){var o="."==t[n].substring(0,1)?t[n].substring(1):t[n],r=new RegExp("{{"+n+"}}","ig");e=e.replace(r,o)}return e}function u(){var e=i();for(var t in e)e.hasOwnProperty(t)&&(window[t]=document.querySelector(e[t]))}function p(e){if(e=e||window._lastColorData,window._lastColorData=e,e){var n="";switch(o.layout){case"round":n=['<div class="{{wrapper}}">','    <div class="{{textWrapper}}">','        <img class="{{text}}" src="data:image/png;base64,'+e.wordPic+'">','        <p class="{{resultMessage}}"></p>',"    </div>",'    <div class="{{sliderContainer}}">','        <div class="{{sliderWrapper}}">','            <div class="{{imgWrapper}}">',function(){var t=e.colorStrip,n="";for(var o in t)if(t.hasOwnProperty(o)){var r=["width:"+100*t[o]+"%"].join(";");n=n+'<div class="{{sliderBlock}}" style="'+r+'">                                <span class="{{sliderColorPane}}" style="background-color: '+o+'"></span></div>'}return n}(),"            </div>",'            <div class="{{slider}}"><span class="{{sliderColorCircle}}"></span></div>',"        </div>","    </div>","</div>"].join("\n");break;case"center":default:n=['<div class="{{wrapper}}">','    <div class="{{sliderContainer}}">','        <div class="{{sliderWrapper}}">','            <div class="{{imgWrapper}}">',function(){var t=e.colorStrip,n="";for(var o in t)if(t.hasOwnProperty(o)){var r=["background-color:"+o,"width:"+100*t[o]+"%"].join(";");n=n+'<div class="{{sliderBlock}}" style="'+r+'"></div>'}return n}(),"            </div>",'            <div class="{{slider}}">&gt;</div>',"        </div>","    </div>",'    <div class="{{textWrapper}}">','        <img class="{{text}}" src="data:image/png;base64,'+e.wordPic+'">','        <p class="{{resultMessage}}"></p>',"    </div>","</div>"].join("\n")}n=d(n),document.body.innerHTML=n,a(o.style),u(),M?t(window.slider,"touchstart",g):t(window.slider,"mousedown",x),t(window.resultMessage,"click",function(){E("callback",{callbackName:"reset"})})}}function f(e,t){l({url:W,params:{width:Number(e)||400,channelId:o.channelId}},function(e,n){return e?(E("event",{eventName:"loadScriptError",args:[W,e]}),document.body.className="error",void $("error",e.msg)):n&&0===n.ret?void(t&&t(n.data)):($("error",n.msg),E("text",n),void(document.body.className="error"))})}function h(e){T||(B=parseInt(s(e),10),L=parseInt(window.slider.style.left||0,10),j&&clearTimeout(j),e.preventDefault())}function w(e){if(!T){var t,n,r;if("round"===o.layout){t=window.sliderWrapper.clientWidth,n=parseInt(s(e),10)-B,r=L+n,r=r<0?0:r>t-40?t-40:r,window.slider.style.left=r+"px";var i=window.imgWrapper.clientWidth,a=Math.floor((r-20)/i*100);if(a>0&&a<100){for(var c,l=window.colorStrip.length,d=0;d<l;d++){var u=window.colorStrip[d],p=window.colorStrip[d-1]||{pos:0};if(a>=p.pos&&a<u.pos){c={start:p.pos,end:u.pos,color:u.color};break}}c||(c={start:window.colorStrip[l-1].pos,end:window.colorStrip[l-2].pos,color:window.colorStrip[l-1].color});var f=(c.end-c.start)/2,h=Math.abs(a-(c.start+f)),w=1-h/f;window.sliderColorCircle.style.background=c.color,window.sliderColorCircle.style.transform="scale("+w+")"}else window.sliderColorCircle.style.background="none"}else t=window.sliderWrapper.clientWidth,n=parseInt(s(e),10)-B,r=L+n,r=r<0?0:r>t?t:r,window.slider.style.left=r+"px";var m="undefined"!=typeof TouchEvent&&e instanceof TouchEvent;clearTimeout(_),e.preventDefault(),O||(_=setTimeout(function(){var e;try{e=m?new TouchEvent("touchend"):new MouseEvent("mouseup")}catch(t){e=document.createEvent("Event"),e.initEvent(m?"touchend":"mouseup",!0,!0)}!window.dispatchEvent(e)},o.timeout))}}function m(e){if(!T&&!O){var t,n;"round"===o.layout?(t=window.imgWrapper.clientWidth,n=parseInt(window.slider.style.left||0)-20):(t=window.sliderWrapper.clientWidth,n=parseInt(window.slider.style.left||0)),percentage=n/t,j=setTimeout(function(){O=!0,C(),j=null},o.delay),e.preventDefault()}}function g(e){h(e),t(window,"touchmove",b),t(window,"touchend",y),t(window,"touchcancel",v)}function b(e){w(e)}function y(e){m(e),n(window,"touchmove",b),n(window,"touchend",y)}function v(e){m(e),n(window,"touchmove",b),n(window,"touchcancel",v)}function x(e){h(e),t(window,"mousemove",k),t(window,"mouseup",S)}function k(e){w(e)}function S(e){m(e),n(window,"mousemove",k),n(window,"mouseup",S)}function C(){T=!0,E("event",{eventName:"submit"}),l({url:I,params:{slideId:o.slideId,offset:percentage,channelId:o.channelId}},function(e,t){if(O=!1,e)return E("event",{eventName:"loadScriptError",args:[I,e]}),document.body.className="error",void $("error",e.msg);var n=0==t.ret?"success":"error";t.slideId=o.slideId,E("text",t),$(n,t.msg),document.body.className=n})}function E(e,t){var n="Captcha: ",r=n+o.id+" --- "+JSON.stringify({type:e,data:t});window.top.postMessage(r,o.origin)}function $(t,n){o.showMessage&&(e(window.text.style,{display:"none"}),e(window.resultMessage.style,{display:"block"}),window.resultMessage.innerHTML=n)}var I="//commoncgi.wepiao.com/slideVerify/verifySlideVerify.php",W="//commoncgi.wepiao.com/slideVerify/createSlideVerify.php",M=function(){try{return document.createEvent("TouchEvent"),!0}catch(e){return!1}}(),N={params:null,url:null},j=null,T=!1,B=0,L=0,O=!1,_=null;E("event",{eventName:"mount"}),f(o.width,function(e){window.colorStrip=[];var t=0;for(var n in e.colorStrip)e.colorStrip.hasOwnProperty(n)&&(t+=100*e.colorStrip[n],window.colorStrip.push({color:n,pos:t}));p(e),o.slideId=e.slideId,E("event",{eventName:"ready"})}),window.flushLayout=function(e){e.style&&(o.style=e.style),e.layout&&(o.layout=e.layout,p())}}function c(c,l,d){var u={delay:l.delay,timeout:l.timeout,width:l.width,style:l._style,showMessage:l.showMessage,origin:l.origin,id:l.id,channelId:l.channelId,layout:l.layout},p=document.createElement("iframe");p.src="about:blank",p.className="captcha-container",p.setAttribute("frameborder","0"),p.setAttribute("scrolling","no"),c.appendChild(p),e(p.style,{border:"none",width:"100%",height:"100%","min-width":"100%",width:"100px","*width":"100%"});var f=document.createElement("script"),h=[r.toString(),i.toString(),a.toString(),e.toString(),t.toString(),n.toString(),o.toString()],w=setInterval(function(){if(!p.contentDocument&&!p.contentWindow)return clearInterval(w),void(d[l.id].onIframeError&&d[l.id].onIframeError());var e=p.contentDocument||p.contentWindow.document;if("complete"===e.readyState){clearInterval(w);var t=[";("+s.toString()+")("+JSON.stringify(u)+", document.body);"];f.innerHTML=h.concat(t).join("\n"),p.contentWindow.document.head.appendChild(f),d&&d(p)}},10)}function l(e){var t,n=e.substring(9).split(" --- "),o=n[0];try{t=JSON.parse(n[1])}catch(r){t={type:"text",data:{ret:-1,msg:"parse result fail:"+r.message,data:r.data}}}if("text"===t.type)0!==t.data.ret?w[o].onError&&w[o].onError(t.data):w[o].onSuccess&&w[o].onSuccess(t.data);else if("callback"===t.type){var i=f.getInstance(o),a=t.data.callbackName;if(!i||!a)return;i[a]&&i[a]()}else if("event"===t.type){var s="on"+t.data.eventName.charAt(0).toUpperCase()+t.data.eventName.slice(1),c=t.data.args||[],l=t.data.context;w[o][s]&&w[o][s].apply(l,c)}}function d(){window.onmessage=function(e){var t=location.protocol+"//"+location.host;e.origin!==t&&"about:"!==e.origin||"string"!=typeof e.data||"Captcha:"===!e.data.substring(0,8)||l(e.data)}}function u(e){for(var t,n="abcdefghijklmnopqrstuvwxyz",o=n.split(""),r=0,i=o.length,a=[];r<i;r++)t=1===Math.round(Math.random()),a.push(t?o[r].toUpperCase():o[r]);return o=a.sort(function(){return 1===Math.round(Math.random())?-1:1}).slice(0,e),o.join("")}function p(){}function f(t){this.id=u(8)+String(+new Date),this.VERSION="0.02",this.options=e({},h,t),this.options.id=this.id,this.options.origin=location.protocol+"//"+location.host,this.hasInitialize=!1,this._setLayout(),d(),w[this.id]={onSuccess:this.options.onSuccess,onError:this.options.onError,onReady:this.options.onReady,onMount:this.options.onMount,onSubmit:this.options.onSubmit,onIframeError:this.options.onIframeError,onLoadScriptError:this.options.onLoadScriptError,onSetConfig:this.options.onSetConfig,onReset:this.options.onReset},f.instances.push(this)}var h={channelId:26,onSuccess:p,onError:p,onReady:p,onMount:p,onSubmit:p,onIframeError:p,onLoadScriptError:p,onReset:p,onSetConfig:p,delay:200,timeout:1e3,width:400,style:{slider:{defaultBackground:null,successBackground:null,errorBackground:null},body:{defaultBackground:null,successBackground:null,errorBackground:null},text:{defaultBackground:"#ffd900",successBackground:null,errorBackground:"#f24f3c",defaultTextColor:null,successTextColor:null,errorTextColor:"#ffffff"}},showMessage:!0,layout:null},w={};f.instances=[],f.VERSION="0.02",f.getInstance=function(e){for(var t=null,n=0,o=f.instances.length;n<o;n++)if(f.instances[n].id==e){t=f.instances[n];break}return t};var m=f.prototype;return m.setConfig=function(t){this.options=e({},this.options,t),w[this.id].onSetConfig&&w[this.id].onSetConfig(),w[this.id]={onSuccess:this.options.onSuccess,onError:this.options.onError,onReady:this.options.onReady,onMount:this.options.onMount,onSubmit:this.options.onSubmit,onIframeError:this.options.onIframeError,onLoadScriptError:this.options.onLoadScriptError,onSetConfig:this.options.onSetConfig,onReset:this.options.onReset},this._setLayout()},m._setLayout=function(){var t={},n=this.options.style;switch(t.sliderWrapper={"default":{background:n.slider.defaultBackground},success:{background:n.slider.successBackground},error:{background:n.slider.errorBackground}},t.textWrapper={"default":{background:n.text.defaultBackground},success:{background:n.text.successBackground},error:{background:n.text.errorBackground}},t.resultMessage={success:{color:n.text.successTextColor},error:{color:n.text.errorTextColor}},t.body={"default":{background:n.body.defaultBackground},success:{background:n.body.successBackground},error:{background:n.body.errorBackground}},this.options._style={},this.options.layout){case"center":e(this.options._style,t,{wrapper:{"default":{height:"100%",display:"-webkit-box",$display:"-ms-flexbox",$$display:"-webkit-flex",$$$display:"flex","-webkit-box-orient":"vertical","-webkit-box-direction":"normal","-ms-flex-direction":"column","-webkit-flex-direction":"column","flex-direction":"column"}},textWrapper:{"default":{background:"#ffd900",padding:"30px 50px",height:"40px",margin:"0"},success:{padding:"30px 0"},error:{padding:"30px 0"}},sliderContainer:{"default":{"-webkit-box-flex":1,"-ms-flex":1,"-webkit-flex":1,flex:1,display:"-webkit-box",$display:"-ms-flexbox",$$display:"-webkit-flex",$$$display:"flex","-webkit-box-align":"center","-ms-flex-align":"center","-webkit-align-items":"center","align-items":"center","-webkit-box-pack":"center","-ms-flex-pack":"center","-webkit-justify-content":"center","justify-content":"center"}},sliderWrapper:{"default":{width:"75%",position:"relative"}},body:{"default":{padding:0}}});break;case"round":e(this.options._style,t,{body:{"default":{display:"-webkit-box",$display:"-ms-flexbox",$$display:"-webkit-flex",$$$display:"flex","-webkit-box-align":"center","-ms-flex-align":"center","-webkit-align-items":"center","align-items":"center","-webkit-box-pack":"center","-ms-flex-pack":"center","-webkit-justify-content":"center","justify-content":"center","-webkit-box-orient":"vertical","-webkit-box-direction":"normal","-ms-flex-direction":"column","-webkit-flex-direction":"column","flex-direction":"column",padding:"0 30px"}},wrapper:{"default":{width:"100%"}},textWrapper:{"default":{background:"transparent",margin:"0 0 20px",padding:"0 20px 20px"},error:{background:"transparent"}},resultMessage:{error:{color:"#000"},success:{color:"#000"}},sliderWrapper:{"default":{position:"relative",background:"#ecf0f3","border-radius":"50px",padding:"0 40px"}},imgWrapper:{"default":{border:"none",height:"40px","border-radius":0}},slider:{"default":{display:"-webkit-box",$display:"-ms-flexbox",$$display:"-webkit-flex",$$$display:"flex","-webkit-box-align":"center","-ms-flex-align":"center","-webkit-align-items":"center","align-items":"center","-webkit-box-pack":"center","-ms-flex-pack":"center","-webkit-justify-content":"center","justify-content":"center",width:"40px",height:"40px","border-radius":"50%",border:"none","box-shadow":"0 2px 5px rgba(0, 0, 0, 0.3)",top:"-1px",transform:"initial","-webkit-transform":"initial","-ms-transform":"initial","-moz-transform":"initial"}},sliderBlock:{"default":{display:"-webkit-inline-box",$display:"-ms-inline-flexbox",$$display:"-webkit-inline-flex",$$$display:"inline-flex","-webkit-box-align":"center","-ms-flex-align":"center","-webkit-align-items":"center","align-items":"center","-webkit-box-pack":"center","-ms-flex-pack":"center","-webkit-justify-content":"center","justify-content":"center"}},sliderColorPane:{"default":{width:"18px",height:"18px",display:"inline-block","border-radius":"50%"}},sliderColorCircle:{"default":{display:"inline-block",width:"32px",height:"32px","border-radius":"50%"}}});break;default:e(this.options._style,t)}if(this.hasInitialize){var r=o("script");r.type="text/javascript",this.iframe&&this.iframe.contentWindow.flushLayout&&this.iframe.contentWindow.flushLayout({style:this.options._style,layout:this.options.layout})}},m.reset=function(){if(this.container){var e=this;this.container.innerHTML="",c(this.container,this.options,function(t){e.element=t.contentWindow.document.body,e.iframe=t}),this.hasInitialize=!0,w[this.id].onReset&&w[this.id].onReset()}},m.appendTo=function(e){if(e instanceof Element){var t=this;this.container=e,c(e,this.options,function(e){t.element=e.contentWindow.document.body,t.iframe=e}),this.hasInitialize=!0}},f});
;(function() {var moduleName = "captcha";var scripts = [].slice.call(document.querySelectorAll("script"));var parseUrl = function(url){    var a = document.createElement("a");    a.href = url;    return {hostname: a.hostname, pathname: a.pathname};};var targetScripts = scripts.filter(function (item) {    if (!item.src) return false;    var obj = parseUrl(item.src);    return ["module.wepiao.com", "res.wxmovie.com", "module-pre.wepiao.com"].indexOf(obj.hostname) !== -1 && (new RegExp(moduleName, "i")).test(obj.pathname);});var url = targetScripts.length ? targetScripts[0].src : "";if (!url) {return;}var iframe = document.createElement("iframe");var hostname = parseUrl(url).hostname;var base = hostname.indexOf(".wepiao.com") !== -1 ? ("//" + hostname) : "//res.wxmovie.com/module";iframe.src = base + "/updater/index.html?url=" + encodeURIComponent(url) + "&moduleName=captcha&hash=8f248a70f8a1634025afe1b90c77fe56";iframe.setAttribute("frameborder", "0");iframe.setAttribute("scrolling", "no");(document.head || document.body).appendChild(iframe);})()